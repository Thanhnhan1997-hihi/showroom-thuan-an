<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nhu C·∫ßu Xe Th√°ng 3 - Showroom Thu·∫≠n An</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script defer src="https://unpkg.com/lucide@latest"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.css">
</head>
<body class="bg-gray-100 text-gray-900">
    <div class="container mx-auto py-10 px-4 md:px-10">
        <h2 class="text-3xl font-bold text-center mb-6 text-blue-600 flex justify-center items-center gap-2">
            <i data-lucide="truck" class="w-8 h-8"></i>
            Nhu C·∫ßu Xe Th√°ng 3 - Showroom Thu·∫≠n An
        </h2>
        
        <div class="bg-white shadow-lg rounded-xl p-6 mb-6">
            <h3 class="text-2xl font-semibold mb-4 text-gray-700 flex items-center gap-2">
                <i data-lucide="plus-circle"></i> Th√™m ƒê∆°n H√†ng
            </h3>
            <form id="orderForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <select class="border p-3 rounded-lg select2" id="tuVanBH">
                    <option value="">üîπ Ch·ªçn T∆∞ V·∫•n BH</option>
                    <option>ƒêinh Tr·ªçng Nh√¢n</option>
                    <option>L√™ Mai Anh</option>
                    <option>Nguy·ªÖn VƒÉn Gi√°p</option>
                </select>
                <select class="border p-3 rounded-lg select2" id="dongXe">
                    <option value="">üöò Ch·ªçn D√≤ng Xe</option>
                    <option>VF3</option>
                    <option>VF5</option>
                </select>
                <input type="text" placeholder="üè∑Ô∏è Phi√™n B·∫£n" class="border p-3 rounded-lg w-full" id="phienBan">
                <input type="text" placeholder="üé® Ngo·∫°i Th·∫•t" class="border p-3 rounded-lg w-full" id="ngoaiThat">
                <input type="text" placeholder="üõãÔ∏è N·ªôi Th·∫•t" class="border p-3 rounded-lg w-full" id="noiThat">
                <input type="text" placeholder="üìå VSO" class="border p-3 rounded-lg w-full" id="vso">
                <input type="text" placeholder="üë§ T√™n KH" class="border p-3 rounded-lg w-full" id="tenKH">
                <input type="date" class="border p-3 rounded-lg w-full" id="ngayCoc">
                <input type="text" placeholder="üí∞ T√¨nh Tr·∫°ng Thanh To√°n" class="border p-3 rounded-lg w-full" id="tinhTrangThanhToan">
                <button type="button" class="col-span-1 md:col-span-2 bg-blue-600 hover:bg-blue-800 text-white font-semibold py-3 rounded-lg transition-transform hover:scale-105" onclick="themDonHang()">
                    <i data-lucide="plus"></i> Th√™m ƒê∆°n H√†ng
                </button>
            </form>
        </div>
        
        <div class="bg-white shadow-lg rounded-xl p-6">
            <h3 class="text-2xl font-semibold mb-4 text-gray-700 flex items-center gap-2">
                <i data-lucide="list"></i> Danh S√°ch ƒê∆°n H√†ng (<span id="totalOrders">0</span>)
            </h3>
            <!-- M·ª•c t√¨m ki·∫øm ƒë∆°n h√†ng -->
            <div class="mb-4">
                <input type="text" id="searchInput" placeholder="üîç T√¨m ki·∫øm ƒë∆°n h√†ng..." class="border p-3 rounded-lg w-full">
            </div>
            <button class="mb-4 bg-green-500 hover:bg-green-700 text-white py-2 px-4 rounded" onclick="exportToExcel()">üì§ Xu·∫•t Excel</button>
            <table class="w-full border-collapse border border-gray-300" id="orderTable">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="border p-2">T∆∞ V·∫•n BH</th>
                        <th class="border p-2">D√≤ng Xe</th>
                        <th class="border p-2">Phi√™n B·∫£n</th>
                        <th class="border p-2">Ngo·∫°i Th·∫•t</th>
                        <th class="border p-2">N·ªôi Th·∫•t</th>
                        <th class="border p-2">VSO</th>
                        <th class="border p-2">T√™n KH</th>
                        <th class="border p-2">Ng√†y C·ªçc</th>
                        <th class="border p-2">Thanh To√°n</th>
                        <th class="border p-2">Th·ªùi Gian Nh·∫≠p Li·ªáu</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <script>
        function themDonHang() {
            let inputs = ['#tuVanBH', '#dongXe', '#phienBan', '#ngoaiThat', '#noiThat', '#vso', '#tenKH', '#ngayCoc', '#tinhTrangThanhToan'];
            let data = {};
            let isValid = true;
            inputs.forEach(id => {
                let input = $(id);
                data[id] = input.val().trim();
                if (!data[id]) {
                    input.addClass('border-red-500');
                    isValid = false;
                } else {
                    input.removeClass('border-red-500');
                }
            });

            // Ki·ªÉm tra T√™n KH ch·ªâ ch·ª©a ch·ªØ
            if (!/^[a-zA-Z\s]+$/.test(data['#tenKH'])) {
                Swal.fire('L·ªói!', 'T√™n kh√°ch h√†ng ch·ªâ ƒë∆∞·ª£c ph√©p nh·∫≠p ch·ªØ!', 'error');
                return;
            }

            // Ki·ªÉm tra ng√†y c·ªçc kh√¥ng ƒë∆∞·ª£c l√† ng√†y trong t∆∞∆°ng lai
            if (new Date(data['#ngayCoc']) > new Date()) {
                Swal.fire('L·ªói!', 'Ng√†y c·ªçc kh√¥ng th·ªÉ l√† ng√†y trong t∆∞∆°ng lai!', 'error');
                return;
            }

            if (!isValid) return Swal.fire('L·ªói!', 'Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
            if ($('#orderTable tbody tr td:nth-child(6)').toArray().some(td => td.innerText === data['#vso'])) {
                return Swal.fire('L·ªói!', 'VSO ƒë√£ t·ªìn t·∫°i!', 'error');
            }
            data['#time'] = new Date().toLocaleString('vi-VN');
            $('#orderTable tbody').append(`<tr>${Object.values(data).map(val => `<td class='border p-2'>${val}</td>`).join('')}</tr>`);
            $('#totalOrders').text($('#orderTable tbody tr').length);
            inputs.forEach(id => $(id).val(''));
            toastr.success('ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c th√™m!');
            // Cu·ªôn xu·ªëng b·∫£ng
            $('html, body').animate({
                scrollTop: $('#orderTable').offset().top
            }, 1000);
        }

        // Th√™m ch·ª©c nƒÉng t√¨m ki·∫øm ƒë∆°n h√†ng
        $("#searchInput").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            $("#orderTable tbody tr").filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
            });
        });
    </script>
</body>
</html>
